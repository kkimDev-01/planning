<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2a2a2a">
  <title>ëª©í‘œ íƒ‘</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif; 
      transition: background-color 0.3s, color 0.3s; 
      overflow: hidden;
      height: 100vh;
    }
    body.light { background-color: #f5f5f5; color: #333; }
    body.dark { background-color: #1a1a1a; color: #e0e0e0; }
    
    /* í—¤ë” */
    .header { 
      position: fixed; 
      top: 0; 
      left: 0; 
      right: 0; 
      height: 60px; 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 0 15px; 
      z-index: 100; 
    }
    body.light .header { background-color: #fff; border-bottom: 1px solid #e0e0e0; }
    body.dark .header { background-color: #2a2a2a; border-bottom: 1px solid #444; }
    
    .hamburger { 
      width: 30px; 
      height: 30px; 
      cursor: pointer; 
      display: flex; 
      flex-direction: column; 
      justify-content: space-around; 
      padding: 5px 0; 
    }
    .hamburger span { 
      display: block; 
      height: 3px; 
      background-color: currentColor; 
      border-radius: 2px; 
    }
    
    .theme-toggle { 
      width: 40px; 
      height: 40px; 
      border-radius: 50%; 
      border: none; 
      cursor: pointer; 
      font-size: 20px; 
    }
    body.light .theme-toggle { background-color: #333; color: #fff; }
    body.dark .theme-toggle { background-color: #fff; color: #333; }
    
    /* ì‚¬ì´ë“œë°” */
    .sidebar { 
      position: fixed; 
      top: 0; 
      left: -280px; 
      width: 280px; 
      height: 100vh; 
      z-index: 200; 
      transition: left 0.3s; 
      padding: 20px; 
      overflow-y: auto; 
    }
    body.light .sidebar { background-color: #fff; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
    body.dark .sidebar { background-color: #2a2a2a; box-shadow: 2px 0 10px rgba(0,0,0,0.5); }
    .sidebar.open { left: 0; }
    
    .sidebar-overlay { 
      position: fixed; 
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0; 
      background-color: rgba(0,0,0,0.5); 
      z-index: 150; 
      display: none; 
    }
    .sidebar-overlay.show { display: block; }
    
    .sidebar-item { 
      padding: 15px 10px; 
      margin: 5px 0; 
      cursor: pointer; 
      border-radius: 8px; 
      font-weight: 500;
    }
    body.light .sidebar-item:hover { background-color: #f0f0f0; }
    body.dark .sidebar-item:hover { background-color: #3a3a3a; }
    .sidebar-item.active { 
      background-color: #2196f3 !important; 
      color: #fff; 
    }
    
    .sidebar-divider {
      height: 1px;
      margin: 10px 0;
    }
    body.light .sidebar-divider { background-color: #e0e0e0; }
    body.dark .sidebar-divider { background-color: #444; }
    
    /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
    .main-container { 
      position: fixed;
      top: 60px;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .goal-header {
      padding: 20px;
      flex-shrink: 0;
    }
    
    .goal-header h1 {
      font-size: 22px;
      margin-bottom: 15px;
      text-align: center;
    }
    
    .date-selector {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
      align-items: center;
    }
    
    .date-input {
      padding: 8px 12px;
      border: 1px solid;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      width: 100px;
    }
    body.light .date-input { 
      background-color: #f9f9f9; 
      border-color: #ddd; 
      color: #333; 
    }
    body.dark .date-input { 
      background-color: #333; 
      border-color: #555; 
      color: #e0e0e0; 
    }
    
    .tick-count-selector {
      padding: 8px 12px;
      border: 1px solid;
      border-radius: 8px;
      font-size: 14px;
      text-align: center;
      min-width: 120px;
    }
    body.light .tick-count-selector { 
      background-color: #f9f9f9; 
      border-color: #ddd; 
      color: #333; 
    }
    body.dark .tick-count-selector { 
      background-color: #333; 
      border-color: #555; 
      color: #e0e0e0; 
    }
    
    .add-goal-btn {
      padding: 12px 24px;
      background-color: #2196f3;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    .add-goal-btn:active {
      transform: scale(0.98);
    }
    
    /* íƒ‘ ì»¨í…Œì´ë„ˆ - ìŠ¤í¬ë¡¤ ê°€ëŠ¥ */
    .tower-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    /* íƒ‘ ì¸µ */
    .tower-block {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 20px;
      color: #fff;
      cursor: move;
      position: relative;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 15px;
      min-height: 80px;
    }
    
    .tower-block:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.2);
    }
    
    .tower-block.completed {
      opacity: 0.4;
      filter: grayscale(0.8);
    }
    
    .tower-block.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }
    
    .tower-block.drag-over {
      border: 2px dashed #ffd700;
    }
    
    .achievement-checkbox {
      width: 24px;
      height: 24px;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .block-content-wrapper {
      flex: 1;
      cursor: pointer;
    }
    
    .block-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .block-content {
      font-size: 14px;
      opacity: 0.9;
      line-height: 1.6;
      white-space: pre-wrap;
    }
    
    .block-number {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      font-weight: 700;
      opacity: 0.3;
    }
    
    /* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
    .tower-block.color-0 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .tower-block.color-1 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .tower-block.color-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .tower-block.color-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
    .tower-block.color-4 { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
    .tower-block.color-5 { background: linear-gradient(135deg, #30cfd0 0%, #330867 100%); }
    .tower-block.color-6 { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
    .tower-block.color-7 { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
    .tower-block.color-8 { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
    .tower-block.color-9 { background: linear-gradient(135deg, #ff6e7f 0%, #bfe9ff 100%); }
    
    /* ë¹ˆ íƒ‘ ë©”ì‹œì§€ */
    .empty-tower {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .empty-tower-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    
    /* ê¸°ê°„ ëª©í‘œ íƒ€ì„ë¼ì¸ */
    .timeline-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 20px;
    }
    
    .timeline-item {
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 12px;
      cursor: pointer;
    }
    body.light .timeline-item { background-color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    body.dark .timeline-item { background-color: #2a2a2a; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    
    .timeline-header {
      margin-bottom: 15px;
    }
    
    .timeline-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .timeline-dates {
      font-size: 13px;
      opacity: 0.7;
    }
    
    .timeline-bar-container {
      position: relative;
      height: 100px;
      margin: 15px 0;
    }
    
    .timeline-bar {
      position: relative;
      height: 8px;
      border-radius: 4px;
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      margin: 26px 0;
    }
    
    .timeline-ticks {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 100%;
      display: flex;
      justify-content: space-between;
    }
    
    .timeline-tick {
      width: 1px;
      height: 20px;
      background-color: rgba(0,0,0,0.2);
      position: relative;
      top: -6px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .tick-date {
      position: absolute;
      top: 25px;
      font-size: 11px;
      white-space: nowrap;
      opacity: 0.7;
      transform: translateX(-50%);
    }
    
    .tick-day {
      position: absolute;
      top: 40px;
      font-size: 10px;
      white-space: nowrap;
      opacity: 0.6;
      transform: translateX(-50%);
    }
    
    .timeline-runner {
      position: absolute;
      top: -15px;
      transform: translateX(-50%) scaleX(-1);
      font-size: 30px;
      z-index: 10;
      animation: bounce 1s ease-in-out infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateX(-50%) scaleX(-1) translateY(0); }
      50% { transform: translateX(-50%) scaleX(-1) translateY(-5px); }
    }
    
    .timeline-content {
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      margin-top: 10px;
    }
    
    .timeline-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid;
    }
    body.light .timeline-footer { border-color: #e0e0e0; }
    body.dark .timeline-footer { border-color: #444; }
    
    .timeline-pagination {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .page-btn {
      padding: 6px 12px;
      border: 1px solid;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
      background-color: transparent;
    }
    body.light .page-btn { 
      border-color: #ddd; 
      color: #666;
    }
    body.dark .page-btn { 
      border-color: #555; 
      color: #aaa;
    }
    
    .page-btn.active {
      background-color: #2196f3;
      color: #fff;
      border-color: #2196f3;
    }
    
    .page-btn:hover:not(.active) {
      background-color: rgba(33, 150, 243, 0.1);
    }
    
    .timeline-edit-btn {
      padding: 8px 16px;
      background-color: #2196f3;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }
    
    /* ëª¨ë‹¬ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 300;
      align-items: center;
      justify-content: center;
      background-color: rgba(0,0,0,0.5);
    }
    .modal.show { display: flex; }
    
    .modal-content {
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    body.light .modal-content { background-color: #fff; }
    body.dark .modal-content { background-color: #2a2a2a; }
    
    .modal-header {
      padding: 20px;
      font-size: 18px;
      font-weight: 600;
      border-bottom: 1px solid;
    }
    body.light .modal-header { border-color: #e0e0e0; }
    body.dark .modal-header { border-color: #444; }
    
    .modal-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal-footer {
      padding: 15px 20px;
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      border-top: 1px solid;
    }
    body.light .modal-footer { border-color: #e0e0e0; }
    body.dark .modal-footer { border-color: #444; }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }
    
    input[type="text"], input[type="date"], textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
    }
    body.light input[type="text"], body.light input[type="date"], body.light textarea { 
      background-color: #f9f9f9; 
      border-color: #ddd; 
      color: #333; 
    }
    body.dark input[type="text"], body.dark input[type="date"], body.dark textarea { 
      background-color: #333; 
      border-color: #555; 
      color: #e0e0e0; 
    }
    
    textarea {
      min-height: 150px;
      resize: vertical;
      line-height: 1.6;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }
    
    .modal-btn.primary {
      background-color: #2196f3;
      color: #fff;
    }
    
    .modal-btn.danger {
      background-color: #f44336;
      color: #fff;
    }
    
    .modal-btn.secondary {
      background-color: #f5f5f5;
      color: #666;
    }
    body.dark .modal-btn.secondary {
      background-color: #3a3a3a;
      color: #aaa;
    }
    
    .delete-btn-container {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid;
    }
    body.light .delete-btn-container { border-color: #e0e0e0; }
    body.dark .delete-btn-container { border-color: #444; }
    
    /* ë°ì´í„° ê´€ë¦¬ í˜ì´ì§€ */
    .data-management {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .data-section {
      margin-bottom: 30px;
      padding: 20px;
      border-radius: 12px;
    }
    body.light .data-section { background-color: #fff; }
    body.dark .data-section { background-color: #2a2a2a; }
    
    .data-section h2 {
      font-size: 20px;
      margin-bottom: 15px;
    }
    
    .data-section p {
      margin-bottom: 15px;
      line-height: 1.6;
      opacity: 0.8;
    }
    
    .data-btn {
      padding: 12px 24px;
      background-color: #2196f3;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    
    .data-btn.danger {
      background-color: #f44336;
    }
    
    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body class="light">
  <!-- í—¤ë” -->
  <div class="header">
    <div class="hamburger" onclick="toggleSidebar()">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</button>
  </div>
  
  <!-- ì‚¬ì´ë“œë°” -->
  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
  <div class="sidebar">
    <div class="sidebar-item active" onclick="showGoalType('life', this)">ì¸ìƒ</div>
    <div class="sidebar-item" onclick="showGoalType('year', this)">ì—°</div>
    <div class="sidebar-item" onclick="showGoalType('month', this)">ì›”</div>
    <div class="sidebar-item" onclick="showGoalType('week', this)">ì£¼</div>
    <div class="sidebar-item" onclick="showGoalType('day', this)">ì¼</div>
    <div class="sidebar-item" onclick="showGoalType('period', this)">ê¸°ê°„</div>
    <div class="sidebar-divider"></div>
    <div class="sidebar-item" onclick="showDataManagement(this)">ë°ì´í„° ê´€ë¦¬</div>
  </div>
  
  <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
  <div class="main-container" id="mainContainer">
    <!-- ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì½˜í…ì¸ ê°€ ë¡œë“œë©ë‹ˆë‹¤ -->
  </div>
  
  <!-- ëª©í‘œ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal" id="goalModal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="modalTitle">ëª©í‘œ ì¶”ê°€</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ì œëª©</label>
          <input type="text" id="goalTitle" placeholder="ëª©í‘œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="form-group">
          <label class="form-label">ë‚´ìš©</label>
          <textarea id="goalContent" placeholder="ëª©í‘œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <div class="delete-btn-container" id="deleteContainer" style="display: none;">
          <button class="modal-btn danger" style="width: 100%;" onclick="deleteGoal()">ëª©í‘œ ì‚­ì œ</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" onclick="closeModal()">ì·¨ì†Œ</button>
        <button class="modal-btn primary" onclick="saveGoal()">ì €ì¥</button>
      </div>
    </div>
  </div>
  
  <!-- ê¸°ê°„ ëª©í‘œ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div class="modal" id="periodModal">
    <div class="modal-content">
      <div class="modal-header">
        <span id="periodModalTitle">ê¸°ê°„ ëª©í‘œ ì¶”ê°€</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">ì‹œì‘ ë‚ ì§œ</label>
          <input type="date" id="periodStartDate">
        </div>
        <div class="form-group">
          <label class="form-label">ì¢…ë£Œ ë‚ ì§œ</label>
          <input type="date" id="periodEndDate">
        </div>
        <div class="form-group">
          <label class="form-label">ì œëª©</label>
          <input type="text" id="periodTitle" placeholder="ê¸°ê°„ ëª©í‘œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="form-group">
          <label class="form-label">ë‚´ìš©</label>
          <textarea id="periodContent" placeholder="ê¸°ê°„ ëª©í‘œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>
        <div class="delete-btn-container" id="periodDeleteContainer" style="display: none;">
          <button class="modal-btn danger" style="width: 100%;" onclick="deletePeriodGoal()">ëª©í‘œ ì‚­ì œ</button>
        </div>
      </div>
      <div class="modal-footer">
        <button class="modal-btn secondary" onclick="closePeriodModal()">ì·¨ì†Œ</button>
        <button class="modal-btn primary" onclick="savePeriodGoal()">ì €ì¥</button>
      </div>
    </div>
  </div>
  
  <script>
    // ì „ì—­ ë³€ìˆ˜
    let currentGoalType = 'life';
    let currentYear = null;
    let currentMonth = null;
    let currentDay = null;
    let editingGoalId = null;
    let draggedElement = null;
    let draggedIndex = null;
    
    const goalTypeNames = {
      'life': 'ì¸ìƒ',
      'year': 'ì—°',
      'month': 'ì›”',
      'week': 'ì£¼',
      'day': 'ì¼',
      'period': 'ê¸°ê°„'
    };
    
    // í•œêµ­ ì‹œê°„ ê¸°ì¤€ ì˜¤ëŠ˜ ë‚ ì§œ
    function getKoreanDate() {
      const now = new Date();
      const koreaTime = new Date(now.getTime() + (9 * 60 * 60 * 1000));
      return {
        year: koreaTime.getUTCFullYear(),
        month: koreaTime.getUTCMonth() + 1,
        day: koreaTime.getUTCDate(),
        date: koreaTime
      };
    }
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
    const storage = {
      getGoals: function(type, year, month, day) {
        let key = `goals_${type}`;
        if (year) key += `_${year}`;
        if (month) key += `_${month}`;
        if (day) key += `_${day}`;
        
        const data = localStorage.getItem(key);
        return data ? JSON.parse(data) : [];
      },
      
      saveGoals: function(type, goals, year, month, day) {
        let key = `goals_${type}`;
        if (year) key += `_${year}`;
        if (month) key += `_${month}`;
        if (day) key += `_${day}`;
        
        localStorage.setItem(key, JSON.stringify(goals));
      },
      
      addGoal: function(type, goal, year, month, day) {
        const goals = this.getGoals(type, year, month, day);
        goal.id = Date.now();
        goal.createdAt = new Date().toISOString();
        goal.completed = false;
        goals.unshift(goal); // ìµœì‹  ëª©í‘œë¥¼ ë§¨ ì•ì— ì¶”ê°€ (í™”ë©´ì—ì„œëŠ” ìœ„ì— í‘œì‹œ)
        this.saveGoals(type, goals, year, month, day);
        return goal;
      },
      
      updateGoal: function(type, goalId, updatedGoal, year, month, day) {
        const goals = this.getGoals(type, year, month, day);
        const index = goals.findIndex(g => g.id === goalId);
        if (index !== -1) {
          goals[index] = { ...goals[index], ...updatedGoal, updatedAt: new Date().toISOString() };
          this.saveGoals(type, goals, year, month, day);
          return true;
        }
        return false;
      },
      
      toggleCompleted: function(type, goalId, year, month, day) {
        const goals = this.getGoals(type, year, month, day);
        const goal = goals.find(g => g.id === goalId);
        if (goal) {
          goal.completed = !goal.completed;
          this.saveGoals(type, goals, year, month, day);
          return goal.completed;
        }
        return false;
      },
      
      deleteGoal: function(type, goalId, year, month, day) {
        const goals = this.getGoals(type, year, month, day);
        const filtered = goals.filter(g => g.id !== goalId);
        this.saveGoals(type, filtered, year, month, day);
      },
      
      reorderGoals: function(type, fromIndex, toIndex, year, month, day) {
        const goals = this.getGoals(type, year, month, day);
        const [movedGoal] = goals.splice(fromIndex, 1);
        goals.splice(toIndex, 0, movedGoal);
        this.saveGoals(type, goals, year, month, day);
      },
      
      exportAllData: function() {
        const allData = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('goals_')) {
            allData[key] = JSON.parse(localStorage.getItem(key));
          }
        }
        return allData;
      },
      
      importAllData: function(data) {
        for (const key in data) {
          if (key.startsWith('goals_')) {
            localStorage.setItem(key, JSON.stringify(data[key]));
          }
        }
      },
      
      clearAllData: function() {
        const keysToRemove = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('goals_')) {
            keysToRemove.push(key);
          }
        }
        keysToRemove.forEach(key => localStorage.removeItem(key));
      }
    };
    
    // ì´ˆê¸°í™”
    function init() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.className = savedTheme;
      document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
      
      const today = getKoreanDate();
      currentYear = today.year;
      currentMonth = today.month;
      currentDay = today.day;
      
      showGoalType('life');
    }
    
    // ëª©í‘œ íƒ€ì… í™”ë©´ í‘œì‹œ
    function showGoalType(type, element) {
      currentGoalType = type;
      
      // ì‚¬ì´ë“œë°” active ìƒíƒœ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
      });
      if (element) {
        element.classList.add('active');
      }
      
      // ì‚¬ì´ë“œë°” ë‹«ê¸°
      if (document.querySelector('.sidebar').classList.contains('open')) {
        toggleSidebar();
      }
      
      // ë‚ ì§œ ì´ˆê¸°í™”
      const today = getKoreanDate();
      currentYear = today.year;
      currentMonth = today.month;
      currentDay = today.day;
      
      // í™”ë©´ ë Œë”ë§
      if (type === 'period') {
        renderPeriodGoalPage();
      } else {
        renderGoalPage();
      }
    }
    
    // ì¼ë°˜ ëª©í‘œ í˜ì´ì§€ ë Œë”ë§
    function renderGoalPage() {
      const typeName = goalTypeNames[currentGoalType];
      let year = null, month = null, day = null;
      
      if (currentGoalType === 'year') year = currentYear;
      if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
      if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
      
      const goals = storage.getGoals(currentGoalType, year, month, day);
      
      let html = `
        <div class="goal-header">
          <h1>${typeName}</h1>
      `;
      
      // ë‚ ì§œ ì„ íƒê¸°
      if (currentGoalType === 'year') {
        html += `
          <div class="date-selector">
            <input type="number" class="date-input" value="${currentYear}" 
                   onchange="currentYear = parseInt(this.value); renderGoalPage();" 
                   min="1900" max="2100" placeholder="ë…„ë„">
          </div>
        `;
      } else if (currentGoalType === 'month') {
        html += `
          <div class="date-selector">
            <input type="number" class="date-input" value="${currentYear}" 
                   onchange="currentYear = parseInt(this.value); renderGoalPage();" 
                   min="1900" max="2100" placeholder="ë…„ë„">
            <input type="number" class="date-input" value="${currentMonth}" 
                   onchange="currentMonth = parseInt(this.value); renderGoalPage();" 
                   min="1" max="12" placeholder="ì›”">
          </div>
        `;
      } else if (currentGoalType === 'day') {
        html += `
          <div class="date-selector">
            <input type="number" class="date-input" value="${currentYear}" 
                   onchange="currentYear = parseInt(this.value); renderGoalPage();" 
                   min="1900" max="2100" placeholder="ë…„ë„">
            <input type="number" class="date-input" value="${currentMonth}" 
                   onchange="currentMonth = parseInt(this.value); renderGoalPage();" 
                   min="1" max="12" placeholder="ì›”">
            <input type="number" class="date-input" value="${currentDay}" 
                   onchange="currentDay = parseInt(this.value); renderGoalPage();" 
                   min="1" max="31" placeholder="ì¼">
          </div>
        `;
      }
      
      html += `
          <button class="add-goal-btn" onclick="openAddModal()">+ ëª©í‘œ ì¶”ê°€</button>
        </div>
        <div class="tower-container" id="towerContainer">
      `;
      
      if (goals.length === 0) {
        html += `
          <div class="empty-tower">
            <div class="empty-tower-icon">ğŸ°</div>
            <p>ì•„ì§ ${typeName} ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <p>ì²« ë²ˆì§¸ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
          </div>
        `;
      } else {
        // ë°°ì—´ì„ ì—­ìˆœìœ¼ë¡œ í‘œì‹œ (ì²« ë²ˆì§¸ ìš”ì†Œê°€ ìœ„ì—, ë§ˆì§€ë§‰ ìš”ì†Œê°€ ì•„ë˜ì—)
        goals.forEach((goal, index) => {
          const colorClass = `color-${index % 10}`;
          const completedClass = goal.completed ? 'completed' : '';
          html += `
            <div class="tower-block ${colorClass} ${completedClass}" 
                 draggable="true"
                 data-index="${index}"
                 data-id="${goal.id}">
              <input type="checkbox" class="achievement-checkbox" 
                     ${goal.completed ? 'checked' : ''}
                     data-goal-id="${goal.id}">
              <div class="block-content-wrapper" data-goal-id="${goal.id}">
                <div class="block-number">${goals.length - index}</div>
                <div class="block-title">${escapeHtml(goal.title)}</div>
                <div class="block-content">${escapeHtml(goal.content).substring(0, 100)}${goal.content.length > 100 ? '...' : ''}</div>
              </div>
            </div>
          `;
        });
      }
      
      html += `</div>`;
      
      document.getElementById('mainContainer').innerHTML = html;
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      attachGoalEventListeners();
    }
    
    // ê¸°ê°„ ëª©í‘œ í˜ì´ì§€ ë Œë”ë§
    function renderPeriodGoalPage() {
      const goals = storage.getGoals('period');
      const today = getKoreanDate().date;
      
      // ëˆˆê¸ˆ ê°œìˆ˜ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
      const savedTickCount = localStorage.getItem('ticksPerPage') || '10';
      
      let html = `
        <div class="goal-header">
          <h1>ê¸°ê°„</h1>
          <div class="date-selector">
            <label for="tickCountSelector">í˜ì´ì§€ë‹¹ ëˆˆê¸ˆ ìˆ˜:</label>
            <select id="tickCountSelector" class="tick-count-selector" onchange="changeTicksPerPage(this.value)">
              <option value="5" ${savedTickCount === '5' ? 'selected' : ''}>5ê°œ</option>
              <option value="7" ${savedTickCount === '7' ? 'selected' : ''}>7ê°œ</option>
              <option value="10" ${savedTickCount === '10' ? 'selected' : ''}>10ê°œ</option>
              <option value="14" ${savedTickCount === '14' ? 'selected' : ''}>14ê°œ</option>
              <option value="20" ${savedTickCount === '20' ? 'selected' : ''}>20ê°œ</option>
              <option value="30" ${savedTickCount === '30' ? 'selected' : ''}>30ê°œ</option>
            </select>
          </div>
          <button class="add-goal-btn" onclick="openPeriodModal()">+ ê¸°ê°„ ëª©í‘œ ì¶”ê°€</button>
        </div>
        <div class="timeline-container">
      `;
      
      if (goals.length === 0) {
        html += `
          <div class="empty-tower">
            <div class="empty-tower-icon">ğŸ¯</div>
            <p>ì•„ì§ ê¸°ê°„ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <p>ì²« ë²ˆì§¸ ê¸°ê°„ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
          </div>
        `;
      } else {
        const ticksPerPage = parseInt(savedTickCount);
        
        goals.forEach((goal, goalIndex) => {
          const [startY, startM, startD] = goal.startDate.split('-').map(Number);
          const [endY, endM, endD] = goal.endDate.split('-').map(Number);
          
          const startDate = new Date(startY, startM - 1, startD);
          const endDate = new Date(endY, endM - 1, endD);
          const todayNormalized = new Date(today.getFullYear(), today.getMonth(), today.getDate());
          
          const totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
          const passedDays = Math.floor((todayNormalized - startDate) / (1000 * 60 * 60 * 24));
          
          const totalPages = Math.ceil(totalDays / ticksPerPage);
          
          // í˜„ì¬ ë‚ ì§œê°€ ì†í•œ í˜ì´ì§€ ì°¾ê¸°
          let currentPage = Math.max(1, Math.min(totalPages, Math.floor(passedDays / ticksPerPage) + 1));
          if (!goal.currentPage) {
            goal.currentPage = currentPage;
          }
          
          html += renderTimelineItem(goal, goalIndex, goal.currentPage || currentPage, ticksPerPage);
        });
      }
      
      html += `</div>`;
      
      document.getElementById('mainContainer').innerHTML = html;
      
      // íƒ€ì„ë¼ì¸ ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸
      document.querySelectorAll('.timeline-item').forEach(item => {
        const goalId = parseInt(item.dataset.goalId);
        item.addEventListener('click', function(e) {
          if (!e.target.classList.contains('page-btn') && !e.target.classList.contains('timeline-edit-btn')) {
            const goals = storage.getGoals('period');
            const goal = goals.find(g => g.id === goalId);
            if (goal) {
              const [startY, startM, startD] = goal.startDate.split('-').map(Number);
              const [endY, endM, endD] = goal.endDate.split('-').map(Number);
              
              const startDate = new Date(startY, startM - 1, startD);
              const endDate = new Date(endY, endM - 1, endD);
              const today = getKoreanDate().date;
              const todayNormalized = new Date(today.getFullYear(), today.getMonth(), today.getDate());
              
              const passedDays = Math.floor((todayNormalized - startDate) / (1000 * 60 * 60 * 24));
              const ticksPerPage = parseInt(localStorage.getItem('ticksPerPage') || '10');
              const totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
              const totalPages = Math.ceil(totalDays / ticksPerPage);
              const currentPage = Math.max(1, Math.min(totalPages, Math.floor(passedDays / ticksPerPage) + 1));
              
              goal.currentPage = currentPage;
              renderPeriodGoalPage();
            }
          }
        });
      });
    }
    
    // ëˆˆê¸ˆ ê°œìˆ˜ ë³€ê²½
    function changeTicksPerPage(value) {
      localStorage.setItem('ticksPerPage', value);
      renderPeriodGoalPage();
    }
    
    // íƒ€ì„ë¼ì¸ ì•„ì´í…œ ë Œë”ë§ (í˜ì´ì§• í¬í•¨)
    function renderTimelineItem(goal, goalIndex, currentPage, ticksPerPage = 10) {
      // ë‚ ì§œ ë¬¸ìì—´ì„ ë¡œì»¬ ì‹œê°„ìœ¼ë¡œ íŒŒì‹± (YYYY-MM-DD í˜•ì‹)
      const startDateStr = goal.startDate;
      const endDateStr = goal.endDate;
      const [startY, startM, startD] = startDateStr.split('-').map(Number);
      const [endY, endM, endD] = endDateStr.split('-').map(Number);
      
      const startDate = new Date(startY, startM - 1, startD);
      const endDate = new Date(endY, endM - 1, endD);
      const today = getKoreanDate().date;
      const todayNormalized = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      
      // ì¼ ìˆ˜ ê³„ì‚°
      const totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
      const passedDays = Math.floor((todayNormalized - startDate) / (1000 * 60 * 60 * 24));
      
      console.log('Timeline Debug:', {
        startDate: `${startDate.getFullYear()}-${startDate.getMonth()+1}-${startDate.getDate()}`,
        endDate: `${endDate.getFullYear()}-${endDate.getMonth()+1}-${endDate.getDate()}`,
        today: `${todayNormalized.getFullYear()}-${todayNormalized.getMonth()+1}-${todayNormalized.getDate()}`,
        totalDays,
        passedDays
      });
      
      const totalPages = Math.ceil(totalDays / ticksPerPage);
      
      // í˜„ì¬ í˜ì´ì§€ì— í‘œì‹œí•  ë‚ ì§œ ë²”ìœ„ (dayIndexëŠ” 0ë¶€í„° ì‹œì‘)
      const startDayIndex = (currentPage - 1) * ticksPerPage;
      const endDayIndex = Math.min(startDayIndex + ticksPerPage, totalDays);
      const daysInPage = endDayIndex - startDayIndex;
      
      // í˜„ì¬ í˜ì´ì§€ ë‚´ì—ì„œ ì˜¤ëŠ˜ì˜ ìœ„ì¹˜ ê³„ì‚°
      // passedDaysëŠ” 0ë¶€í„° ì‹œì‘ (0 = ì‹œì‘ì¼)
      let runnerPosition = -1;
      if (passedDays >= startDayIndex && passedDays < endDayIndex) {
        // passedDaysê°€ 0ì´ë©´ ì²« ë²ˆì§¸ ëˆˆê¸ˆ(startDayIndex=0)ì— ìœ„ì¹˜í•´ì•¼ í•¨
        const relativePosition = passedDays - startDayIndex;
        runnerPosition = (relativePosition / daysInPage) * 100;
        
        console.log('Runner Position Debug:', {
          passedDays,
          startDayIndex,
          endDayIndex,
          daysInPage,
          relativePosition,
          runnerPosition: runnerPosition + '%'
        });
      }
      
      // ëˆˆê¸ˆê³¼ ë‚ ì§œ ìƒì„±
      let ticks = '';
      for (let i = 0; i <= daysInPage; i++) {
        const dayIndex = startDayIndex + i;
        if (dayIndex < totalDays) {
          const tickDate = new Date(startDate);
          tickDate.setDate(startDate.getDate() + dayIndex);
          
          const dateStr = `${tickDate.getMonth() + 1}/${tickDate.getDate()}`;
          const dayStr = getDayOfWeek(tickDate);
          
          console.log(`Tick ${i}: dayIndex=${dayIndex}, date=${dateStr}, isToday=${dayIndex === passedDays}`);
          
          ticks += `
            <div class="timeline-tick">
              <span class="tick-date">${dateStr}</span>
              <span class="tick-day">${dayStr}</span>
            </div>
          `;
        }
      }
      
      // í˜ì´ì§€ ë²„íŠ¼ ìƒì„±
      let pagination = '';
      if (totalPages > 1) {
        for (let i = 1; i <= totalPages; i++) {
          const activeClass = i === currentPage ? 'active' : '';
          pagination += `<button class="page-btn ${activeClass}" onclick="changeTimelinePage(${goal.id}, ${i}, event)">${i}</button>`;
        }
      }
      
      let html = `
        <div class="timeline-item" data-goal-id="${goal.id}">
          <div class="timeline-header">
            <div class="timeline-title">${escapeHtml(goal.title)}</div>
            <div class="timeline-dates">
              ${formatDate(startDate)} ~ ${formatDate(endDate)} (${totalDays}ì¼) | ì˜¤ëŠ˜: ${today.getMonth()+1}/${today.getDate()} | ê²½ê³¼: ${passedDays}ì¼
            </div>
          </div>
          <div class="timeline-bar-container">
            <div class="timeline-bar">
              <div class="timeline-ticks">${ticks}</div>
              ${runnerPosition >= 0 ? `<div class="timeline-runner" style="left: ${runnerPosition}%">ğŸƒ</div>` : ''}
            </div>
          </div>
          <div class="timeline-content">${escapeHtml(goal.content)}</div>
          <div class="timeline-footer">
            ${totalPages > 1 ? `<div class="timeline-pagination">${pagination}</div>` : '<div></div>'}
            <button class="timeline-edit-btn" onclick="openEditPeriodModal(${goal.id}, event)">ìˆ˜ì •</button>
          </div>
        </div>
      `;
      
      return html;
    }
    
    // íƒ€ì„ë¼ì¸ í˜ì´ì§€ ë³€ê²½
    function changeTimelinePage(goalId, page, event) {
      event.stopPropagation();
      
      const goals = storage.getGoals('period');
      const goal = goals.find(g => g.id === goalId);
      if (goal) {
        goal.currentPage = page;
        storage.saveGoals('period', goals);
        renderPeriodGoalPage();
      }
    }
    
    // ìš”ì¼ êµ¬í•˜ê¸°
    function getDayOfWeek(date) {
      const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      return days[date.getDay()];
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    function attachGoalEventListeners() {
      // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
      document.querySelectorAll('.achievement-checkbox').forEach(checkbox => {
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation();
          const goalId = parseInt(this.dataset.goalId);
          
          let year = null, month = null, day = null;
          if (currentGoalType === 'year') year = currentYear;
          if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
          if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
          
          storage.toggleCompleted(currentGoalType, goalId, year, month, day);
          renderGoalPage();
        });
      });
      
      // ë¸”ë¡ í´ë¦­ ì´ë²¤íŠ¸
      document.querySelectorAll('.block-content-wrapper').forEach(wrapper => {
        wrapper.addEventListener('click', function(e) {
          const goalId = parseInt(this.dataset.goalId);
          openEditModal(goalId);
        });
      });
      
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸
      document.querySelectorAll('.tower-block').forEach(block => {
        block.addEventListener('dragstart', handleDragStart);
        block.addEventListener('dragend', handleDragEnd);
        block.addEventListener('dragover', handleDragOver);
        block.addEventListener('drop', handleDrop);
        block.addEventListener('dragenter', function(e) {
          e.preventDefault();
        });
      });
    }
    
    // ëª¨ë‹¬ ì—´ê¸° (ì¶”ê°€)
    function openAddModal() {
      editingGoalId = null;
      document.getElementById('modalTitle').textContent = `${goalTypeNames[currentGoalType]} ì¶”ê°€`;
      document.getElementById('goalTitle').value = '';
      document.getElementById('goalContent').value = '';
      document.getElementById('deleteContainer').style.display = 'none';
      document.getElementById('goalModal').classList.add('show');
    }
    
    // ëª¨ë‹¬ ì—´ê¸° (ìˆ˜ì •)
    function openEditModal(goalId) {
      let year = null, month = null, day = null;
      if (currentGoalType === 'year') year = currentYear;
      if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
      if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
      
      const goals = storage.getGoals(currentGoalType, year, month, day);
      const goal = goals.find(g => g.id === goalId);
      
      if (!goal) return;
      
      editingGoalId = goalId;
      document.getElementById('modalTitle').textContent = `${goalTypeNames[currentGoalType]} ìˆ˜ì •`;
      document.getElementById('goalTitle').value = goal.title;
      document.getElementById('goalContent').value = goal.content;
      document.getElementById('deleteContainer').style.display = 'block';
      document.getElementById('goalModal').classList.add('show');
    }
    
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal() {
      document.getElementById('goalModal').classList.remove('show');
      editingGoalId = null;
    }
    
    // ëª©í‘œ ì €ì¥
    function saveGoal() {
      const title = document.getElementById('goalTitle').value.trim();
      const content = document.getElementById('goalContent').value.trim();
      
      if (!title) {
        alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!content) {
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      let year = null, month = null, day = null;
      if (currentGoalType === 'year') year = currentYear;
      if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
      if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
      
      if (editingGoalId) {
        // ìˆ˜ì •
        if (confirm('ëª©í‘œë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          storage.updateGoal(currentGoalType, editingGoalId, { title, content }, year, month, day);
          closeModal();
          renderGoalPage();
        }
      } else {
        // ì¶”ê°€
        if (confirm('ëª©í‘œë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          storage.addGoal(currentGoalType, { title, content }, year, month, day);
          closeModal();
          renderGoalPage();
        }
      }
    }
    
    // ëª©í‘œ ì‚­ì œ
    function deleteGoal() {
      if (confirm('ì •ë§ ì´ ëª©í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        let year = null, month = null, day = null;
        if (currentGoalType === 'year') year = currentYear;
        if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
        if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
        
        storage.deleteGoal(currentGoalType, editingGoalId, year, month, day);
        closeModal();
        renderGoalPage();
      }
    }
    
    // ê¸°ê°„ ëª©í‘œ ëª¨ë‹¬
    function openPeriodModal() {
      editingGoalId = null;
      const today = getKoreanDate().date.toISOString().split('T')[0];
      document.getElementById('periodModalTitle').textContent = 'ê¸°ê°„ ëª©í‘œ ì¶”ê°€';
      document.getElementById('periodStartDate').value = today;
      document.getElementById('periodEndDate').value = today;
      document.getElementById('periodTitle').value = '';
      document.getElementById('periodContent').value = '';
      document.getElementById('periodDeleteContainer').style.display = 'none';
      document.getElementById('periodModal').classList.add('show');
    }
    
    function openEditPeriodModal(goalId, event) {
      if (event) {
        event.stopPropagation();
      }
      
      const goals = storage.getGoals('period');
      const goal = goals.find(g => g.id === goalId);
      
      if (!goal) return;
      
      editingGoalId = goalId;
      document.getElementById('periodModalTitle').textContent = 'ê¸°ê°„ ëª©í‘œ ìˆ˜ì •';
      document.getElementById('periodStartDate').value = goal.startDate;
      document.getElementById('periodEndDate').value = goal.endDate;
      document.getElementById('periodTitle').value = goal.title;
      document.getElementById('periodContent').value = goal.content;
      document.getElementById('periodDeleteContainer').style.display = 'block';
      document.getElementById('periodModal').classList.add('show');
    }
    
    function closePeriodModal() {
      document.getElementById('periodModal').classList.remove('show');
      editingGoalId = null;
    }
    
    function savePeriodGoal() {
      const startDate = document.getElementById('periodStartDate').value;
      const endDate = document.getElementById('periodEndDate').value;
      const title = document.getElementById('periodTitle').value.trim();
      const content = document.getElementById('periodContent').value.trim();
      
      if (!startDate || !endDate) {
        alert('ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (new Date(startDate) > new Date(endDate)) {
        alert('ì‹œì‘ ë‚ ì§œê°€ ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ëŠ¦ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!title) {
        alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (!content) {
        alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      if (editingGoalId) {
        if (confirm('ê¸°ê°„ ëª©í‘œë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          storage.updateGoal('period', editingGoalId, { startDate, endDate, title, content });
          closePeriodModal();
          renderPeriodGoalPage();
        }
      } else {
        if (confirm('ê¸°ê°„ ëª©í‘œë¥¼ ì¶”ê°€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          storage.addGoal('period', { startDate, endDate, title, content });
          closePeriodModal();
          renderPeriodGoalPage();
        }
      }
    }
    
    function deletePeriodGoal() {
      if (confirm('ì •ë§ ì´ ê¸°ê°„ ëª©í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        storage.deleteGoal('period', editingGoalId);
        closePeriodModal();
        renderPeriodGoalPage();
      }
    }
    
    // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì²˜ë¦¬
    function handleDragStart(e) {
      draggedElement = e.currentTarget;
      draggedIndex = parseInt(e.currentTarget.dataset.index);
      e.currentTarget.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', e.currentTarget.innerHTML);
    }
    
    function handleDragEnd(e) {
      e.currentTarget.classList.remove('dragging');
      document.querySelectorAll('.tower-block').forEach(block => {
        block.classList.remove('drag-over');
      });
    }
    
    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      
      const target = e.currentTarget;
      if (target && target !== draggedElement && target.classList.contains('tower-block')) {
        document.querySelectorAll('.tower-block').forEach(block => {
          block.classList.remove('drag-over');
        });
        target.classList.add('drag-over');
      }
      
      return false;
    }
    
    function handleDrop(e) {
      e.stopPropagation();
      e.preventDefault();
      
      const target = e.currentTarget;
      
      if (target && target !== draggedElement && target.classList.contains('tower-block')) {
        const targetIndex = parseInt(target.dataset.index);
        
        let year = null, month = null, day = null;
        if (currentGoalType === 'year') year = currentYear;
        if (currentGoalType === 'month') { year = currentYear; month = currentMonth; }
        if (currentGoalType === 'day') { year = currentYear; month = currentMonth; day = currentDay; }
        
        storage.reorderGoals(currentGoalType, draggedIndex, targetIndex, year, month, day);
        renderGoalPage();
      }
      
      document.querySelectorAll('.tower-block').forEach(block => {
        block.classList.remove('drag-over');
      });
      
      return false;
    }
    
    // ë°ì´í„° ê´€ë¦¬ í˜ì´ì§€
    function showDataManagement(element) {
      // ì‚¬ì´ë“œë°” active ìƒíƒœ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
      });
      if (element) {
        element.classList.add('active');
      }
      
      // ì‚¬ì´ë“œë°” ë‹«ê¸°
      if (document.querySelector('.sidebar').classList.contains('open')) {
        toggleSidebar();
      }
      
      const html = `
        <div class="data-management">
          <h1 style="text-align: center; margin-bottom: 30px; font-size: 22px;">ë°ì´í„° ê´€ë¦¬</h1>
          
          <div class="data-section">
            <h2>ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h2>
            <p>ëª¨ë“  ëª©í‘œ ë°ì´í„°ë¥¼ JSON íŒŒì¼ë¡œ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ë°±ì—…ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ì´ë™í•  ë•Œ í™œìš©í•˜ì„¸ìš”.</p>
            <button class="data-btn" onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
          </div>
          
          <div class="data-section">
            <h2>ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h2>
            <p>ì´ì „ì— ë‚´ë³´ë‚¸ JSON íŒŒì¼ì„ ê°€ì ¸ì˜µë‹ˆë‹¤. ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©ë©ë‹ˆë‹¤.</p>
            <input type="file" id="importFile" accept=".json" onchange="importData(event)">
            <button class="data-btn" onclick="document.getElementById('importFile').click()">ğŸ“¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
          </div>
          
          <div class="data-section">
            <h2>âš ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</h2>
            <p>ì£¼ì˜: ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ëª¨ë“  ëª©í‘œ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.</p>
            <button class="data-btn danger" onclick="clearAllData()">ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
          </div>
        </div>
      `;
      
      document.getElementById('mainContainer').innerHTML = html;
    }
    
    function exportData() {
      const data = storage.exportAllData();
      const dataStr = JSON.stringify(data, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `goal-tower-backup-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      
      URL.revokeObjectURL(url);
      alert('ë°ì´í„°ê°€ ë‚´ë³´ë‚´ê¸° ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
    
    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (confirm('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©ë©ë‹ˆë‹¤.')) {
            storage.importAllData(data);
            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤!');
            showGoalType('life');
          }
        } catch (error) {
          alert('ì˜¬ë°”ë¥¸ JSON íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤.');
        }
      };
      reader.readAsText(file);
    }
    
    function clearAllData() {
      if (confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) {
        if (confirm('í•œ ë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤. ì •ë§ë¡œ ëª¨ë“  ëª©í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          storage.clearAllData();
          alert('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          showGoalType('life');
        }
      }
    }
    
    // ì‚¬ì´ë“œë°” í† ê¸€
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
    }
    
    // í…Œë§ˆ í† ê¸€
    function toggleTheme() {
      const current = document.body.className;
      const newTheme = current === 'dark' ? 'light' : 'dark';
      document.body.className = newTheme;
      localStorage.setItem('theme', newTheme);
      document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
    }
    
    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // ë‚ ì§œ í¬ë§·
    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      return `${year}.${month}.${day}`;
    }
    
    // ì´ˆê¸° ì‹¤í–‰
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
